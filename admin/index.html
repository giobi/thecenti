<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheCenti - Dashboard Band</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="icon" href="../assets/img/favicon.ico" type="image/x-icon">
</head>
<body class="dashboard-body">
    <header class="dashboard-header">
        <div class="container">
            <h1>üé∏ TheCenti - Control Room</h1>
            <div class="status-indicator" id="connectionStatus">
                <span class="status-dot offline"></span>
                <span class="status-text">Disconnesso</span>
            </div>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="container">
            <!-- Cluster Selector Section -->
            <section class="control-section">
                <div class="section-header">
                    <h2>üéµ Seleziona Cluster</h2>
                    <div class="section-status" id="clusterStatus">
                        <span class="status-badge">NESSUNO</span>
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="cluster-selector">
                        <select id="clusterSelect" class="cluster-select">
                            <option value="">-- Scegli Cluster --</option>
                            <option value="italia">üáÆüáπ ITALIA (30.1%)</option>
                            <option value="80s">üéπ 80S (11.3%)</option>
                            <option value="boyband">üë¶ BOYBAND (3.8%)</option>
                            <option value="dance">üíÉ DANCE (9.8%)</option>
                            <option value="rock">üé∏ ROCK (11.3%)</option>
                            <option value="ballad">üé§ BALLAD (14.3%)</option>
                            <option value="filler">üìª FILLER (18.0%)</option>
                            <option value="revival">üåü REVIVAL (1.5%)</option>
                        </select>
                        <button class="btn-generate" id="generateSongs">üé≤ Genera 3 Canzoni</button>
                    </div>
                    
                    <div class="vote-options" id="voteOptions" style="display: none;">
                        <h3>Opzioni di Voto</h3>
                        <div class="option-list" id="optionList">
                            <!-- Le 3 opzioni verranno generate dinamicamente -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Vote Control Section -->
            <section class="control-section">
                <div class="section-header">
                    <h2>üó≥Ô∏è Controllo Voti</h2>
                    <div class="section-status" id="voteStatus">
                        <span class="status-badge closed">CHIUSO</span>
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="big-toggle-group">
                        <button class="big-toggle-btn" id="toggleVote" data-action="start">
                            <span class="btn-icon">‚ñ∂Ô∏è</span>
                            <span class="btn-text">APRI VOTI</span>
                        </button>
                    </div>
                    
                    <div class="control-grid">
                        <div class="control-card">
                            <h3>Timer Votazione</h3>
                            <div class="timer-controls">
                                <select id="voteTimer" class="timer-select">
                                    <option value="30">30 secondi</option>
                                    <option value="60" selected>1 minuto</option>
                                    <option value="120">2 minuti</option>
                                    <option value="180">3 minuti</option>
                                </select>
                                <button class="timer-btn" id="startTimer">Start Timer</button>
                            </div>
                            <div class="timer-display" id="timerDisplay">--:--</div>
                        </div>
                        
                        <div class="control-card">
                            <h3>Risultati Live</h3>
                            <div class="vote-results" id="liveResults">
                                <div class="result-item">
                                    <span class="song-name">Canzone 1</span>
                                    <span class="vote-percent">0%</span>
                                </div>
                                <div class="result-item">
                                    <span class="song-name">Canzone 2</span>
                                    <span class="vote-percent">0%</span>
                                </div>
                                <div class="result-item">
                                    <span class="song-name">Canzone 3</span>
                                    <span class="vote-percent">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI Request Control Section -->
            <section class="control-section">
                <div class="section-header">
                    <h2>ü§ñ Controllo AI Richieste</h2>
                    <div class="section-status" id="aiStatus">
                        <span class="status-badge closed">DISABILITATO</span>
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="big-toggle-group">
                        <button class="big-toggle-btn" id="toggleAI" data-action="start">
                            <span class="btn-icon">ü§ñ</span>
                            <span class="btn-text">ABILITA AI</span>
                        </button>
                    </div>
                    
                    <div class="control-grid">
                        <div class="control-card full-width">
                            <h3>Coda Richieste AI</h3>
                            <div class="ai-queue" id="aiQueue">
                                <div class="queue-item">
                                    <div class="request-info">
                                        <div class="request-text">"Suonate qualcosa di energico per far ballare tutti!"</div>
                                        <div class="request-meta">Da: Marco ‚Ä¢ 2 min fa ‚Ä¢ Mood: Energia</div>
                                    </div>
                                    <div class="request-actions">
                                        <button class="btn-approve">‚úÖ</button>
                                        <button class="btn-reject">‚ùå</button>
                                    </div>
                                </div>
                                <div class="queue-item">
                                    <div class="request-info">
                                        <div class="request-text">"Potreste fare una cover di Vasco?"</div>
                                        <div class="request-meta">Da: Sara ‚Ä¢ 5 min fa ‚Ä¢ Mood: Rock</div>
                                    </div>
                                    <div class="request-actions">
                                        <button class="btn-approve">‚úÖ</button>
                                        <button class="btn-reject">‚ùå</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Generated Songs Section -->
            <section class="control-section">
                <div class="section-header">
                    <h2>üéµ Canzoni AI Generate</h2>
                </div>

                <div class="control-panel">
                    <div class="control-grid">
                        <div class="control-card full-width">
                            <h3>Canzoni Pronte</h3>
                            <div class="generated-songs-list" id="generatedSongsContainer">
                                <div class="no-requests">Nessuna canzone generata</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="control-section">
                <div class="section-header">
                    <h2>‚ö° Azioni Rapide</h2>
                </div>
                
                <div class="quick-actions">
                    <button class="quick-btn" id="resetAll">
                        üîÑ Reset Tutto
                    </button>
                    <button class="quick-btn" id="showQR">
                        üì± Mostra QR
                    </button>
                    <button class="quick-btn" id="emergencyStop">
                        üö® Stop Emergenza
                    </button>
                </div>

                <!-- Quick QR Display -->
                <div class="quick-qr-section" style="margin-top: 2rem;">
                    <h3 style="color: #ff6b35; margin-bottom: 1rem;">üì± QR Codes per il Pubblico</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div style="text-align: center;">
                            <h4>üó≥Ô∏è Vota</h4>
                            <div id="quickVoteQR" style="margin: 0 auto; width: 150px; height: 150px; border: 2px solid #ff6b35; border-radius: 10px; display: flex; align-items: center; justify-content: center; background: white; color: #333;">
                                QR Voti
                            </div>
                            <p style="font-size: 0.8rem; margin-top: 0.5rem;">Scansiona per votare</p>
                        </div>
                        <div style="text-align: center;">
                            <h4>ü§ñ AI Request</h4>
                            <div id="quickAIQR" style="margin: 0 auto; width: 150px; height: 150px; border: 2px solid #ff6b35; border-radius: 10px; display: flex; align-items: center; justify-content: center; background: white; color: #333;">
                                QR AI
                            </div>
                            <p style="font-size: 0.8rem; margin-top: 0.5rem;">Scansiona per richieste</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- QR Modal -->
    <div class="modal" id="qrModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Codici QR per il Pubblico</h2>
            <div class="qr-grid">
                <div class="qr-item">
                    <h3>Vota la Prossima Canzone</h3>
                    <div class="qr-code" id="voteQR">
                        <!-- QR code will be generated here -->
                        <div class="qr-placeholder">QR Code Voti</div>
                    </div>
                    <p>giobi.github.io/thecenti/live/vote.html</p>
                </div>
                <div class="qr-item">
                    <h3>Richiedi Canzone all'AI</h3>
                    <div class="qr-code" id="aiQR">
                        <!-- QR code will be generated here -->
                        <div class="qr-placeholder">QR Code AI</div>
                    </div>
                    <p>giobi.github.io/thecenti/live/request.html</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="../assets/js/dashboard.js"></script>
    <script>
        // QR Code generation when modal opens
        document.getElementById('showQR').addEventListener('click', function() {
            generateQRCodes();
        });

        function generateQRCodes() {
            const voteURL = 'https://giobi.github.io/thecenti/live/vote.html';
            const aiURL = 'https://giobi.github.io/thecenti/live/request.html';
            
            // Generate Vote QR (Modal)
            const voteQR = document.getElementById('voteQR');
            voteQR.innerHTML = '';
            QRCode.toCanvas(voteQR, voteURL, {
                width: 200,
                margin: 2,
                color: { dark: '#000000', light: '#FFFFFF' }
            }, function (error) {
                if (error) {
                    voteQR.innerHTML = '<div class="qr-error">Errore generazione QR</div>';
                }
            });
            
            // Generate AI QR (Modal)
            const aiQR = document.getElementById('aiQR');
            aiQR.innerHTML = '';
            QRCode.toCanvas(aiQR, aiURL, {
                width: 200,
                margin: 2,
                color: { dark: '#000000', light: '#FFFFFF' }
            }, function (error) {
                if (error) {
                    aiQR.innerHTML = '<div class="qr-error">Errore generazione QR</div>';
                }
            });

            // Generate Quick Vote QR
            const quickVoteQR = document.getElementById('quickVoteQR');
            quickVoteQR.innerHTML = '';
            QRCode.toCanvas(quickVoteQR, voteURL, {
                width: 150,
                margin: 1,
                color: { dark: '#000000', light: '#FFFFFF' }
            }, function (error) {
                if (error) {
                    quickVoteQR.innerHTML = 'QR Error';
                }
            });

            // Generate Quick AI QR  
            const quickAIQR = document.getElementById('quickAIQR');
            quickAIQR.innerHTML = '';
            QRCode.toCanvas(quickAIQR, aiURL, {
                width: 150,
                margin: 1,
                color: { dark: '#000000', light: '#FFFFFF' }
            }, function (error) {
                if (error) {
                    quickAIQR.innerHTML = 'QR Error';
                }
            });
        }

        // Generate QR codes on page load for immediate availability
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(generateQRCodes, 2000); // Generate after dashboard loads
        });
    </script>
</body>
</html>